diff --git a/index.js b/index.js
index df75004aed7007aaf4624aaa1847a6fedc1bdf09..5f7dab1081e378586856575cccef1b4b4ffdc443 100644
--- a/index.js
+++ b/index.js
@@ -1,6 +1,6 @@
 'use strict';
 
-var parseUrl = require('url').parse;
+var URLCtor = require('url').URL;
 
 var DEFAULT_PORTS = {
   ftp: 21,
@@ -22,7 +22,7 @@ var stringEndsWith = String.prototype.endsWith || function(s) {
  *  given URL. If no proxy is set, this will be an empty string.
  */
 function getProxyForUrl(url) {
-  var parsedUrl = typeof url === 'string' ? parseUrl(url) : url || {};
+  var parsedUrl = normalizeUrl(url);
   var proto = parsedUrl.protocol;
   var hostname = parsedUrl.host;
   var port = parsedUrl.port;
@@ -51,6 +51,23 @@ function getProxyForUrl(url) {
   return proxy;
 }
 
+function normalizeUrl(url) {
+  if (!url) {
+    return {};
+  }
+
+  if (typeof url === 'string') {
+    try {
+      return new URLCtor(url);
+    }
+    catch (err) {
+      return {};
+    }
+  }
+
+  return url;
+}
+
 /**
  * Determines whether a given URL should be proxied.
  *
